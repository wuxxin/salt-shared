[Unit]
Description=Gitops Service Error %I
ConditionFileNotEmpty={{ settings.env_file }}
Wants=network-online.target

[Service]
Type=oneshot
Environment=UNITNAME=%i
EnvironmentFile={{ settings.env_file }}
PassEnvironment=UNITNAME SENTRY_DSN
ExecStart=/bin/bash -c '. /usr/local/lib/gitops-library.sh; \
    extra=$(systemctl status -l -q --no-pager -n 10 $UNITNAME | text2json_status); \
    sentry_entry "Service $UNITNAME Error" "Service ($UNITNAME) failed" error "$extra" '
