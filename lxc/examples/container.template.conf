### Generated by osctld
# Distribution config
{% OsCtld::Lxc::dist_lxc_configs(distribution, version).each do |cfg| -%}
lxc.include = {%= cfg %}
{% end -%}
lxc.include = /etc/lxc/common.conf.d/00-lxcfs.conf
{% if ct.nesting -%}
lxc.include = {%= File.join(Lxc::CONFIGS, 'nesting.conf') %}
{% end -%}

lxc.rootfs.path = {%= ct.rootfs %}
lxc.arch = {%= ct.arch %}
lxc.uts.name = {%= ct.hostname || ct.id %}
lxc.syslogns = 1

# UID/GID mapping
{% ct.user.uid_map.each do |entry| -%}
lxc.idmap = u {%= entry.ns_id %} {%= entry.host_id %} {%= entry.count %}
{% end -%}
{% ct.user.gid_map.each do |entry| -%}
lxc.idmap = g {%= entry.ns_id %} {%= entry.host_id %} {%= entry.count %}
{% end -%}

# Security
lxc.seccomp.profile = {%= ct.seccomp_profile %}
lxc.apparmor.profile = {%= ct.apparmor.namespace_profile_name %}
lxc.autodev = 1


# Init
lxc.init.cmd = {%= ct.format_init_cmd %}

# Internal hooks into osctld
lxc.hook.version = 1
lxc.hook.pre-start = {%= OsCtld::hook_run('ct-pre-start', ct.pool) %}
lxc.hook.pre-mount = {%= OsCtld::hook_run('ct-pre-mount', ct.pool) %}
lxc.hook.mount = {%= OsCtld::hook_run('ct-post-mount', ct.pool) %}
lxc.hook.autodev = {%= OsCtld::hook_run('ct-autodev', ct.pool) %}
lxc.hook.start-host = {%= OsCtld::hook_run('ct-on-start', ct.pool) %}
lxc.hook.post-stop = {%= OsCtld::hook_run('ct-post-stop', ct.pool) %}

# Network interfaces
{% netifs.each_with_index do |netif, i| -%}
{%= ErbTemplate.render("ct/net_interface/#{netif.type}", netif.render_opts) %}
{% end -%}

# Cgroup parameters
{% cgparams.each do |p| -%}
{% next unless %w(cpu).include?(p.subsystem) -%}
{% p.value.each do |v| -%}
lxc.cgroup.{%= p.name %} = {%= v %}
{% end -%}
{% end -%}

# Process limits
{% prlimits.each do |name, limit| -%}
lxc.prlimit.{%= name %} = {%= limit.soft %}:{%= limit.hard %}
{% end -%}

# Mounts
{% mounts.each do |m| -%}
lxc.mount.entry = {%= m.fs %} {%= m.lxc_mountpoint %} {%= m.type %} {%= m.opts %}
{% end -%}

# Appended user raw config
{%= raw %}
