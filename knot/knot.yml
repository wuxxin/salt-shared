server:
{%- for l in dns.listen %}
  - listen: {{ l }}
{%- endfor %}

log:
  - target: syslog
    any: info

key:
{%- for k in dns.key %}
  - id: {{ k.id }}
  - algorithm: {{ k.algorithm|d('hmac-md5') }}
  - secret: {{ k.secret }}
{%- endfor %}

acl:
{%- for k in dns.key %}
  - id: {{ k.id }}
{%- if k.from is defined %}
    address: {{ k.from }}
{%- endif %}
    key: {{ k.id }}
    action: {{ k.action }}
{%- endfor %}

{%- if dns.remote is defined %}
remote:
{%- for k in dns.remote %}
  - id: {{ k.id }}
{%- if k.address is defined %}
    address: {{ k.address }}
{%- endif %}
    key: {{ k.key }}

template:
  - id: unsigned
    storage: /var/lib/knot/{{ dns.id }}/unsigned
    semantic-checks: on
    acl: [{% for k in dns.key %}{{ k.id }},{% endfor %}]
  - id: signed
    storage: /var/lib/knot/{{ dns.id }}/signed
    dnssec-signing: on
    semantic-checks: on
    kasp-db: kasp
    acl: [{% for k in dns.key %}{{ k.id }},{% endfor %}]
  - id: slave
    storage: /var/lib/knot/{{ dns.id }}/slave

zone:
{%- for z in dns.zone %}
  - domain: {{ z.domain }}
    template: {{ z.template|d('unsigned') }}
  {%- if z.notify is defined %}
    notify:
    {%- for addr in z.notify %}
      - {{ addr }}
    {%- endfor %}
  {%- endif %}
{%- endfor %}

