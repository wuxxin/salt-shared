<%args>
    $workgroup
    $netbiosName
    $description
    $mode
    $realm
    $domain
    $roamingProfiles => 0
    $profilesPath
    $sysvolPath
    $ifaces => undef
    $shell

    $print => 0
    $shares => 0
</%args>
<%init>
use EBox::Gettext;
</%init>
[global]
    vfs objects = acl_tdb
    # XXX acl_attr is not available under lxd
    workgroup = <% $workgroup %>
    realm = <% $realm %>
    netbios name = <% $netbiosName %>
    server string = <% $description %>
    server role = <% $mode %>
    server role check:inhibit = yes
    server services = -dns
    server signing = auto
    dsdb:schema update allowed = yes
    ldap server require strong auth = no
    drs:max object sync = 1200

    idmap_ldb:use rfc2307 = yes

    winbind enum users = yes
    winbind enum groups = yes
    template shell = <% $shell %>
    template homedir = /home/%U

    # XX hardcode interface list to not listen on network
    #interfaces = lo sambabr0
    #bind interfaces only = yes

% if ($ifaces) {
    interfaces = <% $ifaces %>
    bind interfaces only = yes
% }

    map to guest = Bad User

    log level = 3
    log file = /var/log/samba/samba.log
    max log size = 100000

% if ($print) {
    include = /etc/samba/printers.conf
% }

% if ($shares) {
    include = /etc/samba/shares.conf
% }



% if ($mode eq 'dc') {
%   if ($roamingProfiles) {
[profiles]
    path = <% $profilesPath %>
    browseable = no
    read only = no
%   }

[netlogon]
    path = <% $sysvolPath %>/<% $domain %>/scripts
    browseable = no
    read only = yes

[sysvol]
    path = <% $sysvolPath %>
    read only = no
% }

